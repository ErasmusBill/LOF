{% extends 'tithe/base.html' %}

{% block title %}Reset Password - Tithe Management System{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-box">
        <div class="logo-section">
            <div class="logo-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
            </div>
            <h1>Reset Password</h1>
            <p class="subtitle">Enter your email to receive reset instructions</p>
        </div>

        {% if messages %}
        <div style="margin-bottom: 20px;">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form method="POST" action="{% url 'tithe:request_password_reset' %}">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-error" style="margin-bottom: 20px;">
                <strong>Please correct the errors below:</strong>
                <ul style="margin: 10px 0 0 20px; padding: 0;">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <div class="form-group">
                <label for="email">Email Address</label>
                <div class="input-wrapper">
                    <div class="input-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           placeholder="your@email.com" 
                           value="{{ form.email.value|default:'' }}"
                           required
                           class="{% if form.email.errors %}error{% endif %}">
                </div>
                {% if form.email.errors %}
                <div class="error-message" style="color: #ef4444; font-size: 14px; margin-top: 5px;">
                    {{ form.email.errors.0 }}
                </div>
                {% endif %}
            </div>

            <button type="submit" class="btn btn-primary">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px; margin-right: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                Send Reset Link
            </button>
        </form>

        <div class="text-link">
            <a href="{% url 'tithe:login_user' %}">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px; margin-right: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Back to Login
            </a>
        </div>

        <div class="text-link">
            Don't have an account? <a href="{% url 'tithe:register_user' %}">Create one here</a>
        </div>

        <!-- Additional Help Information -->
        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: left;">
            <h4 style="font-size: 16px; color: #374151; margin-bottom: 10px; display: flex; align-items: center;">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 18px; height: 18px; margin-right: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Need help?
            </h4>
            <p style="font-size: 14px; color: #6b7280; margin: 0; line-height: 1.5;">
                Enter the email address associated with your account. We'll send you a link to reset your password.
                If you don't receive the email within a few minutes, please check your spam folder.
            </p>
        </div>
    </div>
</div>

<style>
    .error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
    }
    
    .error-message {
        color: #ef4444;
        font-size: 14px;
        margin-top: 5px;
        display: flex;
        align-items: center;
    }
    
    .error-message::before {
        content: 'âš ';
        margin-right: 5px;
        font-size: 12px;
    }
    
    .btn {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Success message styling */
    .alert-success {
        background: #dcfce7;
        color: #166534;
        border-left: 4px solid #16a34a;
        padding: 16px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease;
    }
    
    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border-left: 4px solid #ef4444;
        padding: 16px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
        from {
            transform: translateY(-10px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-focus email field
        const emailField = document.getElementById('email');
        if (emailField) {
            emailField.focus();
        }
        
        // Add real-time validation
        emailField.addEventListener('blur', function() {
            const email = this.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email && !emailRegex.test(email)) {
                this.classList.add('error');
            } else {
                this.classList.remove('error');
            }
        });
        
        // Form submission enhancement
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!email) {
                e.preventDefault();
                showError('Please enter your email address');
                return;
            }
            
            if (!emailRegex.test(email)) {
                e.preventDefault();
                showError('Please enter a valid email address');
                return;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <svg class="animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px; margin-right: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2v4m0 12v4m8-10h-4M6 12H2m15.364-7.364l-2.828 2.828M7.464 17.536l-2.828 2.828m12.728 0l-2.828-2.828M7.464 6.464L4.636 3.636"/>
                </svg>
                Sending Reset Link...
            `;
        });
        
        function showError(message) {
            // Remove existing error messages
            const existingErrors = document.querySelectorAll('.error-message');
            existingErrors.forEach(error => error.remove());
            
            // Add new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            const emailGroup = document.querySelector('.form-group');
            emailGroup.appendChild(errorDiv);
            
            // Add error class to input
            document.getElementById('email').classList.add('error');
            
            // Scroll to error
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
</script>

<style>
    /* Loading animation */
    .animate-spin {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
        .login-box {
            padding: 30px 20px;
            margin: 10px;
        }
        
        .logo-section h1 {
            font-size: 28px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
        }
        
        .logo-icon svg {
            width: 35px;
            height: 35px;
        }
    }
</style>
{% endblock %}